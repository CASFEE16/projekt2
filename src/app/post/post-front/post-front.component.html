<div class="post-front-container">

  <md-card *ngIf="loggedIn" class="post-card">
      <form (ngSubmit)="onSubmit()">
        <div class="post-new-form">
          <div class="post-new-form-data">
            <div>
              <md-input-container>
                <textarea mdInput name="post" placeholder="Post" cols="100" rows="2" [(ngModel)]="post.text" (ngModelChange)="onTextChanged($event)"></textarea>
              </md-input-container>
            </div>
            <div>
              <md-radio-group name="type" [(ngModel)]="post.type">
                <md-radio-button *ngFor="let t of typeList" [value]="t.value">{{t.label}}</md-radio-button>
              </md-radio-group>
            </div>
          </div>
          <div class="post-new-form-action">
            <button md-fab><md-icon>add</md-icon></button>
          </div>
        </div>
      </form>
  </md-card>

  <md-spinner *ngIf="loading"></md-spinner>

  <div>
    <md-card class="post-card" *ngFor="let each of posts | async">
      <md-card-header>
        <div md-card-avatar><md-icon>{{getIcon(each.post)}}</md-icon></div>
        <md-card-title><strong>{{each.post.text}}</strong></md-card-title>
        <md-card-subtitle>{{each.post.date | date}}</md-card-subtitle>
      </md-card-header>
      <md-card-content>
        <iframe *ngIf="youtubeURL(each.post)" width="560" height="315" [src]="youtubeURL(each.post) | safe" frameborder="0" allowfullscreen></iframe>
        <iframe *ngIf="spotifyURL(each.post)" [src]="spotifyURL(each.post) | safe" width="300" height="80" frameborder="0" allowtransparency="true"></iframe>
        <p *ngIf="webURL(each.post)"><a [href]="webURL(each.post) | safe">{{each.post.text}}</a></p>
      </md-card-content>
      <md-card-actions >
        <div class="card-actions">
        <div class="post-card-rating">
          <span class="app-rating-placeholder md-floating-placeholder">Rating</span>
          <app-rating [rating]="each.post.rating" [readonly]="!loggedIn" (onChanged)="onRatingClick(each.post, $event)"></app-rating>
        </div>
        <div class="post-card-show">
          <md-select class="post-card-show-select" placeholder="Show" [(ngModel)]="each.post.show_key" (ngModelChange)="onSelectShow(each.post, show)" [disabled]="!loggedIn">
            <md-option *ngFor="let show of shows | async" [value]="show['$key']">
              {{ show.title }} {{show.date | date}}
            </md-option>
          </md-select>
        </div>
        <div class="post-card-actions" *ngIf="loggedIn">
          <button md-button [mdMenuTriggerFor]="menu"><md-icon>more_vert</md-icon></button>
          <md-menu #menu="mdMenu">
            <button *ngIf="!!each.post.show_key" md-menu-item (click)="onRemoveFromShows(each.post)"><md-icon>clear</md-icon>Remove from show</button>
            <button md-menu-item (click)="onEdit(each.post)"><md-icon>edit</md-icon>Edit</button>
            <button md-menu-item (click)="onDelete(each.post)"><md-icon>delete</md-icon>Delete</button>
          </md-menu>
        </div>
        </div>
      </md-card-actions>
    </md-card>

  </div>
</div>
